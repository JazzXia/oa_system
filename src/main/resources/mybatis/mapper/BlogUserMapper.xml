<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qtatelier.OASystem.basics.userinfo.mapper.BlogUserMapper">
  <resultMap id="BaseResultMap" type="com.qtatelier.dto.BlogUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="userName" jdbcType="VARCHAR" property="username" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="sign" jdbcType="VARCHAR" property="sign" />
    <result column="location" jdbcType="VARCHAR" property="location" />
    <result column="web_url" jdbcType="VARCHAR" property="webUrl" />
    <result column="callself" jdbcType="VARCHAR" property="callself" />
    <result column="nick_name" jdbcType="VARCHAR" property="nickName" />
    <result column="image_name" jdbcType="VARCHAR" property="imageName" />
    <result column="user_email" jdbcType="VARCHAR" property="userEmail" />
    <result column="token" jdbcType="VARCHAR" property="token" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from blog_user
    where user_id = #{userId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.qtatelier.dto.BlogUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into blog_user (user_id, userName, `password`,
    sign, `location`, web_url,
    callself, nick_name, image_name,
    user_email, token)
    values (#{userId,jdbcType=VARCHAR}, #{username,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR},
    #{sign,jdbcType=VARCHAR}, #{location,jdbcType=VARCHAR}, #{webUrl,jdbcType=VARCHAR},
    #{callself,jdbcType=VARCHAR}, #{nickName,jdbcType=VARCHAR}, #{imageName,jdbcType=VARCHAR},
    #{userEmail,jdbcType=VARCHAR}, #{token,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.qtatelier.dto.BlogUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update blog_user
    set userName = #{username,jdbcType=VARCHAR},
    `password` = #{password,jdbcType=VARCHAR},
    sign = #{sign,jdbcType=VARCHAR},
    `location` = #{location,jdbcType=VARCHAR},
    web_url = #{webUrl,jdbcType=VARCHAR},
    callself = #{callself,jdbcType=VARCHAR},
    nick_name = #{nickName,jdbcType=VARCHAR},
    image_name = #{imageName,jdbcType=VARCHAR},
    user_email = #{userEmail,jdbcType=VARCHAR},
    token = #{token,jdbcType=VARCHAR}
    where user_id = #{userId,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="com.qtatelier.OASystem.response.ResBlogUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT
    bu.user_id AS userId,
    br.role_type AS roleType,
    br.role_type_name AS roleTypeName,
    bu.userName AS username,
    bu.`password` AS PASSWORD,
    bu.sign AS sign,
    bu.`location` AS location,
    bu.web_url AS webUrl,
    bu.callself AS callself,
    bu.nick_name AS nickName,
    bu.image_name AS imageName,
    bu.user_email AS userEmail,
    ei.emp_no AS empNo,
    din.duty_name AS dutyName,
    di.dept_name AS deptName,
    di.dept_no AS deptNo,
    bu.token AS token
    FROM
    blog_user bu
    LEFT JOIN link_role_user lru ON bu.user_id = lru.user_id
    LEFT JOIN blog_role br ON lru.role_id = br.role_id
    LEFT JOIN link_emp_user leu ON leu.user_id = bu.user_id
    LEFT JOIN emp_info ei ON ei.emp_id = leu.emp_id
    LEFT JOIN link_duty_dept ldd ON ldd.emp_id = ei.emp_id
    LEFT JOIN duty_info din ON din.duty_id = ldd.duty_id
    LEFT JOIN dept_info di ON di.dept_id = ldd.dept_id
    where bu.user_id = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select user_id, userName, `password`, sign, `location`, web_url, callself, nick_name,
    image_name, user_email, token
    from blog_user
  </select>

  <select id="selectByUserName" resultMap="BaseResultMap" parameterType="com.qtatelier.dto.BlogUser">
    SELECT bu.user_id,br.role_type,br.role_type_name ,bu.userName,bu.`password` ,bu.sign ,bu.`location` ,
	bu.web_url ,bu.callself ,bu.nick_name ,bu.image_name ,bu.user_email,bu.token
    FROM blog_user bu
LEFT JOIN
	link_role_user lru
  ON bu.user_id = lru.user_id
LEFT JOIN
  blog_role br
	ON lru.role_id = br.role_id
    LEFT JOIN link_emp_user leu ON leu.user_id = bu.user_id
    LEFT JOIN emp_info ei ON ei.emp_id = leu.emp_id
WHERE
	userName = #{username,jdbcType=VARCHAR}
	AND ei.is_leave = '1'
  </select>


  <insert id="insertInfo" parameterType="com.qtatelier.OASystem.request.UserEmp">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into blog_user (user_id, userName, `password`,
    sign, `location`, web_url,
    callself, nick_name, image_name,
    user_email, token)
    values (#{userId,jdbcType=VARCHAR}, #{username,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR},
    #{sign,jdbcType=VARCHAR}, #{location,jdbcType=VARCHAR}, #{webUrl,jdbcType=VARCHAR},
    #{callself,jdbcType=VARCHAR}, #{nickName,jdbcType=VARCHAR}, #{imageName,jdbcType=VARCHAR},
    #{userEmail,jdbcType=VARCHAR}, #{token,jdbcType=VARCHAR})
  </insert>

  <select id="empList" resultType="com.qtatelier.OASystem.response.ResBlogUser">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT
    bu.user_id AS userId,
    br.role_type AS roleType,
    br.role_type_name AS roleTypeName,
    bu.userName AS username,
    bu.`password` AS PASSWORD,
    bu.sign AS sign,
    bu.`location` AS location,
    bu.web_url AS webUrl,
    bu.callself AS callself,
    bu.nick_name AS nickName,
    bu.image_name AS imageName,
    bu.user_email AS userEmail,
    ei.emp_no AS empNo,
    din.duty_name AS dutyName,
    di.dept_name AS deptName,
    di.dept_no AS deptNo,
    di.dept_id AS deptId,
    bu.token AS token
    FROM
    blog_user bu
    LEFT JOIN link_role_user lru ON bu.user_id = lru.user_id
    LEFT JOIN blog_role br ON lru.role_id = br.role_id
    LEFT JOIN link_emp_user leu ON leu.user_id = bu.user_id
    LEFT JOIN emp_info ei ON ei.emp_id = leu.emp_id
    LEFT JOIN link_duty_dept ldd ON ldd.emp_id = ei.emp_id
    LEFT JOIN duty_info din ON din.duty_id = ldd.duty_id
    LEFT JOIN dept_info di ON di.dept_id = ldd.dept_id
   WHERE 1 = 1
   AND ei.is_leave = '1'
   <if test="deptId != null">
     AND di.dept_id = #{deptId,jdbcType=VARCHAR}
   </if>
   <if test="nickName != null">
     AND bu.nick_name LIKE '%${nickName}%'
   </if>
  </select>


  <select id="empInfoDetail" resultType="com.qtatelier.OASystem.response.ResBlogUser" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT
    bu.user_id AS userId,
    br.role_type AS roleType,
    br.role_type_name AS roleTypeName,
    bu.userName AS username,
    bu.`password` AS PASSWORD,
    bu.sign AS sign,
    bu.`location` AS location,
    bu.web_url AS webUrl,
    bu.callself AS callself,
    bu.nick_name AS nickName,
    bu.image_name AS imageName,
    bu.user_email AS userEmail,
    ei.emp_no AS empNo,
    din.duty_name AS dutyName,
    di.dept_name AS deptName,
    di.dept_no AS deptNo,
    di.dept_id AS deptId,
    bu.token AS token
    FROM
    blog_user bu
    LEFT JOIN link_role_user lru ON bu.user_id = lru.user_id
    LEFT JOIN blog_role br ON lru.role_id = br.role_id
    LEFT JOIN link_emp_user leu ON leu.user_id = bu.user_id
    LEFT JOIN emp_info ei ON ei.emp_id = leu.emp_id
    LEFT JOIN link_duty_dept ldd ON ldd.emp_id = ei.emp_id
    LEFT JOIN duty_info din ON din.duty_id = ldd.duty_id
    LEFT JOIN dept_info di ON di.dept_id = ldd.dept_id
    WHERE 1 = 1
    AND ei.is_leave = '1'
    AND ei.emp_no = #{empNo}
  </select>
  
  <update id="updatePassword" parameterType="com.qtatelier.OASystem.request.UserPasswordReq">
      UPDATE blog_user
      SET `password` = #{newPassWord,jdbcType = VARCHAR}
      WHERE userName = #{userName,jdbcType = VARCHAR}
  </update>

</mapper>